<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Doppelgänger Mejorado</title>
  <style>
    body {
      margin: 0;
      padding: 0;
      background: url('https://source.unsplash.com/1920x1080/?dark,horror') no-repeat center center fixed;
      background-size: cover;
      color: white;
      font-family: 'Courier New', monospace;
      text-align: center;
      transition: background 1s ease-in-out, filter 0.5s;
      overflow: hidden;
    }
    h1.glitch-text {
      text-shadow: 2px 2px 5px red, -2px -2px 5px blue;
      animation: glitch 0.1s infinite alternate;
      margin-top: 20px;
    }
    @keyframes glitch {
      0%   { transform: translate(0, 0); }
      20%  { transform: translate(-2px, 2px); }
      40%  { transform: translate(2px, -2px); }
      60%  { transform: translate(-1px, 1px); }
      80%  { transform: translate(1px, -1px); }
      100% { transform: translate(0, 0); }
    }
    .chat-container {
      max-width: 500px;
      margin: 20px auto;
      padding: 20px;
      background-color: rgba(0, 0, 0, 0.85);
      border-radius: 10px;
      box-shadow: 0 0 20px rgba(255, 0, 0, 0.3);
      position: relative;
    }
    .messages {
      height: 300px;
      overflow-y: auto;
      border-bottom: 1px solid #ff0000;
      padding-bottom: 10px;
      margin-bottom: 10px;
    }
    .message {
      padding: 10px;
      border-radius: 5px;
      margin: 5px;
      font-size: 1rem;
      opacity: 0;
      animation: fadeIn 0.5s forwards;
    }
    @keyframes fadeIn {
      from { opacity: 0; }
      to   { opacity: 1; }
    }
    .user {
      background-color: #007bff;
      text-align: right;
      color: white;
    }
    .bot {
      background-color: #dc3545;
      text-align: left;
      color: white;
    }
    .glitch-text {
      text-shadow: 2px 2px 5px red, -2px -2px 5px blue;
      animation: glitch 0.1s infinite alternate;
    }
    input, button {
      padding: 8px;
      border-radius: 5px;
      border: 1px solid red;
      background: black;
      color: white;
      font-family: inherit;
    }
  </style>
</head>
<body>
  <h1 class="glitch-text">Doppelgänger Mejorado</h1>
  <div class="chat-container">
    <div class="messages" id="messages"></div>
    <input type="text" id="userInput" placeholder="Escribe tu mensaje..." autofocus />
    <button onclick="sendMessage()">Enviar</button>
  </div>

  <script>
    let userName = "";
    let messageCount = 0;
    let idleTime = 0;
    const surpriseMessages = [
      "Las sombras se mueven sin tu permiso.",
      "Un eco distante repite tu nombre.",
      "Sientes un escalofrío que recorre tu espalda...",
      "Hay un reflejo que parpadea sin que tú lo hagas.",
      "El tiempo se distorsiona en la penumbra.",
      "Un susurro muy cerca de tu oído... ¿lo escuchaste?"
    ];

    function sendMessage() {
      const input = document.getElementById("userInput");
      const messageText = input.value.trim();
      if (messageText === "") return;
      addMessage(messageText, "user");
      setTimeout(() => addMessage(generateResponse(messageText), "bot"), 500 + Math.random() * 1000);
      input.value = "";
    }

    function generateResponse(userMessage) {
      messageCount++;
      if (!userName) {
        userName = userMessage;
        return `Bienvenido, ${userName}. ¿O acaso ya habías estado aquí antes?`;
      }
      return surpriseMessages[Math.floor(Math.random() * surpriseMessages.length)];
    }

    function addMessage(text, sender) {
      const messages = document.getElementById("messages");
      const messageDiv = document.createElement("div");
      messageDiv.classList.add("message", sender);
      if (sender === "bot") messageDiv.classList.add("glitch-text");
      messageDiv.textContent = text;
      messages.appendChild(messageDiv);
      setTimeout(() => { messages.scrollTop = messages.scrollHeight; }, 100);
    }
  </script>
</body>
</html>
